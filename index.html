<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <title>AutoTyping - By Sujeet Kr. Jaiswal</title>
    <meta name="description" content="Auto Typing module demo. This would write the text in an incremental way. The event that it responds to are keypress event and the time based.">
    <meta name="keywords" content="AutoTyping, Demo, TypeScript">
	<link rel="stylesheet" href="./app.css">
</head>
<body>
<div class="bannerBar">
	<a class="links" href="http://sujeetjaiswal.com">Sujeet Kr. Jaiswal</a>
	<span class="btnContainer">
	<button class="btnLinks" onclick="AppInit(event,'timer');">Timer Based</button>
	<button class="btnLinks" onclick="AppInit(event,'keyStroke');">KeyStroke Based</button>
	</span>
</div>
<pre id="autoTypePlayArea"></pre>
<pre id="autoTypeText">
	class CorpusManager {
		private textNodeManger: TextNodeManger;
		private corpusArr: Corpus[];
		private static removePattern: RegExp = new RegExp("^\\^#\\d+#\\^$");
		private static waitPattern: RegExp = new RegExp("^\\^@\\d+@\\^$");

		private currCorpus: Corpus;

		constructor(wholeCorpus: string, element: HTMLElement) {
			this.textNodeManger = new TextNodeManger(element)
			this.corpusArr = this.stringToCorpusArr(wholeCorpus).reverse();
		}
		private stringToCorpusArr(wholeCorpus: string): Corpus[] {
			return wholeCorpus.split(/(\^#\d+#\^|\^@\d+@\^)/g).map((corpus) => this.stringToCorpus(corpus));
		}
		private stringToCorpus(corpusStr: string): Corpus {
			if (CorpusManager.removePattern.test(corpusStr)) {
				return new RemoveCorpus(this.textNodeManger, parseInt(corpusStr.slice(2, -2)) || 0)
			} else if (CorpusManager.waitPattern.test(corpusStr)) {
				return new WaitCorpus(parseInt(corpusStr.slice(2, -2)) || 0);
			} else {
				return new AddCorpus(this.textNodeManger, corpusStr);
			}
		}

		private hasNext(): boolean {
			while ((this.currCorpus == null || this.currCorpus.hasNext() == false) && this.corpusArr.length > 0) {
				this.currCorpus = this.corpusArr.pop();
			}
			return this.currCorpus != null && (this.currCorpus.hasNext() || this.corpusArr.length > 0);
		}
		public doNext(): boolean {
			if (this.hasNext()) {
				this.currCorpus.doNext();
				return this.hasNext();
			} else {
				return false;
			}
		}
	}
</pre>
<script src="./AutoTyping.min.js"></script>
<script>
	if (window.addEventListener) { // Mozilla, Netscape, Firefox
		window.addEventListener('load', InitDemo, false);
	} else if (window.attachEvent) { // IE
		window.attachEvent('onload', InitDemo);
	}
	var app,params = {};
	var btnElements = document.getElementsByClassName("btnLinks");
	function InitDemo(type){
		params.autoTypeText = document.getElementById("autoTypeText").innerText;
		params.playElem = document.getElementById("autoTypePlayArea");
		params.callback	= function(){
			console.log("From Callback","Operation finised.")
		}
		//AppInit("timer")
		btnElements[0].click();
	}
	function cleanUp(){
		params.playElem.innerHTML = "";
		if(app){
			app.stop();
		}
	}
	function AppInit(e,typeStr){
		cleanUp()
		var type = AutoTyping.ListnerType.timer;
		if(typeStr!=="timer"){
			type = AutoTyping.ListnerType.keyStroke;
		}
		app = new AutoTyping.App(params.playElem, params.autoTypeText,type,1,params.callback);
		app.start();
		setMeActive((e.target) ? e.target : e.srcElement);
	}
	function setMeActive(elem){
		//btnThis.blur();
		for(var i =0,len=btnElements.length;i<len;i++){
			btnElements[i].className = "btnLinks";
		}
		elem.className = "btnLinks active";
		elem.blur();
	}
</script>
</body>
</html>